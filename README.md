# CoinMarketCap Cryptocurrency Scraper

A professional web scraping application that collects cryptocurrency data from CoinMarketCap and stores it in SQL Server for analysis.

## üöÄ Features

- **Web Scraping**: Automated scraping of cryptocurrency data using Selenium and BeautifulSoup
- **SQL Server Integration**: Store data in SQL Server with automatic table creation
- **Data Export**: Export data to CSV or Excel formats
- **Data Analysis**: Built-in functions for top gainers/losers analysis
- **Logging**: Comprehensive logging for debugging and monitoring
- **CLI Interface**: Command-line arguments for flexible operation
- **Error Handling**: Robust error handling and recovery

## üìã Requirements

- Python 3.8 or higher
- Chrome browser (for Selenium WebDriver)
- SQL Server (Local or Remote)
- ODBC Driver 17 for SQL Server (or SQL Server driver)

## üîß Installation

### 1. Clone or Download the Repository

```bash
cd coinmarketcap-scraper
```

### 2. Install Python Dependencies

```bash
pip install -r requirements.txt
```

### 3. Setup SQL Server Database

**Option A: Using SQL Server Management Studio (SSMS)**
1. Open SSMS and connect to your SQL Server instance
2. Run the `setup_database.sql` file (generated by running `setup_database.py`)

**Option B: Automatic Setup**
The application will automatically create the table when you first run it (database must exist).

**Option C: Using Python Script**
```bash
python setup_database.py
```
This will generate `setup_database.sql` file with all necessary SQL scripts.

### 4. Configure Database Connection

Edit `config.py` and update the `DB_CONFIG` section:

```python
DB_CONFIG = {
    'server': 'localhost',  # or '.\SQLEXPRESS' or IP address
    'database': 'CryptoData',
    'username': '',  # Leave empty for Windows Authentication
    'password': '',  # Leave empty for Windows Authentication
    'driver': '{ODBC Driver 17 for SQL Server}'
}
```

## üìÅ Project Structure

```
coinmarketcap-scraper/
‚îÇ
‚îú‚îÄ‚îÄ main.py                 # Main application entry point
‚îú‚îÄ‚îÄ scraper.py             # Web scraping logic
‚îú‚îÄ‚îÄ database.py            # SQL Server operations
‚îú‚îÄ‚îÄ utils.py               # Utility functions (export, analysis)
‚îú‚îÄ‚îÄ config.py              # Configuration settings
‚îú‚îÄ‚îÄ setup_database.py      # Database setup script generator
‚îÇ
‚îú‚îÄ‚îÄ requirements.txt       # Python dependencies
‚îú‚îÄ‚îÄ README.md             # This file
‚îú‚îÄ‚îÄ .gitignore            # Git ignore rules
‚îÇ
‚îî‚îÄ‚îÄ code.ipynb            # Jupyter notebook version (optional)
```

## üéØ Usage

### Basic Usage

Scrape data and save to database:
```bash
python main.py
```

### Advanced Usage

**Scrape without saving to database:**
```bash
python main.py --no-save
```

**Show all scraped results:**
```bash
python main.py --show-all
```

**Show database statistics:**
```bash
python main.py --show-stats
```

**Export to CSV:**
```bash
python main.py --export-csv crypto_data.csv
```

**Export to Excel:**
```bash
python main.py --export-excel crypto_data.xlsx
```

**Show top 10 gainers:**
```bash
python main.py --top-gainers 10
```

**Show top 10 losers:**
```bash
python main.py --top-losers 10
```

**Enable verbose logging:**
```bash
python main.py --verbose
```

**Combine multiple options:**
```bash
python main.py --show-stats --top-gainers 5 --export-csv latest.csv
```

## üîç Module Usage Examples

### Using Scraper Module

```python
from scraper import scrape_coinmarketcap

# Scrape cryptocurrency data
crypto_data = scrape_coinmarketcap()

for crypto in crypto_data[:5]:
    print(f"{crypto['rank']} - {crypto['name']}: {crypto['price']}")
```

### Using Database Module

```python
from database import save_to_sql_server, get_crypto_statistics

# Save data
save_to_sql_server(crypto_data)

# Get statistics
stats = get_crypto_statistics()
print(f"Total records: {stats['total_records']}")
```

### Using Utils Module

```python
from utils import get_latest_crypto_dataframe, export_to_csv, get_top_gainers

# Get data as DataFrame
df = get_latest_crypto_dataframe(100)

# Export to CSV
export_to_csv('output.csv', limit=50)

# Get top gainers
gainers = get_top_gainers(10)
print(gainers)
```

## üìä Database Schema

**Table: CryptoCurrency**

| Column | Type | Description |
|--------|------|-------------|
| id | INT | Primary key (auto-increment) |
| rank | INT | Cryptocurrency rank |
| name | NVARCHAR(100) | Cryptocurrency name |
| price | NVARCHAR(50) | Current price |
| one_hour_change | NVARCHAR(20) | 1-hour change percentage |
| twenty_four_hour_change | NVARCHAR(20) | 24-hour change percentage |
| seven_day_change | NVARCHAR(20) | 7-day change percentage |
| market_cap | NVARCHAR(50) | Market capitalization |
| volume_24h | NVARCHAR(50) | 24-hour trading volume |
| circulating_supply | NVARCHAR(100) | Circulating supply |
| scraped_at | DATETIME | Timestamp of data collection |

**Indexes:**
- `idx_name` on `name`
- `idx_rank` on `rank`
- `idx_scraped_at` on `scraped_at`

## üîê SQL Server Authentication

### Windows Authentication (Recommended)
Leave `username` and `password` empty in `config.py`:
```python
DB_CONFIG = {
    'server': 'localhost',
    'database': 'CryptoData',
    'username': '',
    'password': '',
    'driver': '{ODBC Driver 17 for SQL Server}'
}
```

### SQL Server Authentication
Provide credentials in `config.py`:
```python
DB_CONFIG = {
    'server': 'localhost',
    'database': 'CryptoData',
    'username': 'your_username',
    'password': 'your_password',
    'driver': '{ODBC Driver 17 for SQL Server}'
}
```

## üìù Logging

Logs are saved to `crypto_scraper.log` with the following levels:
- **INFO**: Normal operation messages
- **WARNING**: Non-critical issues
- **ERROR**: Errors that need attention
- **DEBUG**: Detailed debug information (use `--verbose`)

## ‚ö†Ô∏è Troubleshooting

### Chrome WebDriver Issues
- Make sure Chrome browser is installed
- WebDriver will be automatically managed by Selenium 4+

### Database Connection Issues
- Verify SQL Server is running
- Check if the database exists
- Confirm ODBC driver is installed
- Test connection settings
- Check Windows Firewall settings

### ODBC Driver Not Found
Install ODBC Driver 17:
- Download from: https://learn.microsoft.com/en-us/sql/connect/odbc/download-odbc-driver-for-sql-server
- Or use `{SQL Server}` driver in config.py

### Module Import Errors
```bash
pip install -r requirements.txt --upgrade
```

## üõ°Ô∏è Best Practices

1. **Rate Limiting**: The scraper includes built-in delays to avoid overwhelming the server
2. **Error Handling**: All functions include proper error handling
3. **Resource Cleanup**: Context managers ensure proper cleanup of resources
4. **Logging**: Comprehensive logging for debugging and monitoring
5. **Data Validation**: Input validation before database insertion

## üìà Future Enhancements

- [ ] Add scheduling support (cron/Windows Task Scheduler)
- [ ] Implement data visualization dashboard
- [ ] Add support for other data sources
- [ ] Implement data comparison between scrapes
- [ ] Add email notifications for price alerts
- [ ] Create REST API wrapper

## üìÑ License

This project is for educational purposes. Please respect CoinMarketCap's robots.txt and Terms of Service.

## üë§ Author

Created for cryptocurrency data analysis and tracking.

## ü§ù Contributing

Feel free to fork, modify, and submit pull requests.

## ‚≠ê Acknowledgments

- CoinMarketCap for providing cryptocurrency data
- Selenium and BeautifulSoup communities
- Python community

---

**Note**: This scraper is for educational and personal use. Always check and respect the website's robots.txt and Terms of Service. Use responsibly and don't overload the server with requests.
